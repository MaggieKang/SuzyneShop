<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hannamsm.shop.domain.membership.dao.MembershipDao">
<select id="findMembership" parameterType="com.hannamsm.shop.domain.membership.vo.MembershipDto" resultType="com.hannamsm.shop.domain.membership.vo.MembershipDto">
SELECT top 1
	 cardKey
   ,a.CardNo
   ,WebID
   ,Lang_cd
   ,StoreCode
   ,CustLanguage
   ,Sex
   ,EnName
   ,Phone
   ,Address
   ,city_cd
   ,City
   ,province_cd
   ,Province
   ,country_cd
   ,PostalCode
   ,EMail
   ,KrName
   ,CardIssueDate
   ,LastModDate 
FROM [dbgal].[dbo].[tblCustomer] a
LEFT OUTER JOIN [dbgal].[dbo].[tblCustomerHist] b
ON a.CardNo = b.CardNo
WHERE  b.NewCardNo is null
AND a.Active = 1
AND a.EnName = #{enName} or a.KrName = #{krName}
AND a.Phone = #{phone}
</select>
</mapper>
